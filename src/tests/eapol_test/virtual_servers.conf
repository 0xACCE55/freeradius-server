# -*- text -*-
##
## test.conf	-- Virtual server configuration for testing radiusd.
##
##	$Id$
##

test_port = $ENV{TEST_PORT}

#  Only for testing!
#  Setting this on a production system is a BAD IDEA.
security {
	allow_vulnerable_openssl = yes
}

#
#  Max outstanding requests
#
max_requests = 100

#
#  References by some modules for default thread pool configuration
#
thread pool {
	start_servers = 1
	max_servers = 1
	max_spare_servers = 1
	min_spare_servers = 0
}

#
#  The test client
#
client eapol_test {
	ipaddr = 127.0.0.1
	secret = testing123
}

#
#  Modules needed for EAP
#
modules {
	$INCLUDE ${maindir}/mods-available/chap
	$INCLUDE ${maindir}/mods-available/pap
	$INCLUDE ${maindir}/mods-available/eap
	$INCLUDE ${maindir}/mods-available/mschap
}

policy {
	files.authorize {
		if (User-Name == "bob") {
			update control {
				Cleartext-Password := "bob"
			}
		}
	}

	$INCLUDE ${maindir}/policy.d/
}

#
#  Minimal set of virtual servers for performing EAP
#
server test {
	listen {
		ipaddr = 127.0.0.1
		port = ${test_port}
		type = auth
	}

	authorize {
		files
		eap
	}

	authenticate {
		eap
		mschap
	}
}

server inner-tunnel {
	authorize {
		files
		pap
		chap
		mschap
		eap
	}

	authenticate {
		pap
		chap
		mschap
		eap
	}
}
