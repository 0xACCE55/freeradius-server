
@INCLUDE@ @IQUOTE@../../Make.inc@IQUOTE@

SERVER_OBJS	= radiusd.o files.o util.o acct.o nas.o log.o valuepair.o \
		  version.o proxy.o exec.o auth.o timestr.o \
		  modules.o radutmp.o $(MODULE_PATHS)
INCLUDES	= ../include/radiusd.h ../include/conf.h ../include/modules.h
BUILDDBM	= @BUILDDBM@

CFLAGS		+= -I../include
LDFLAGS		+= -L../lib -rdynamic
LIBS		+= -lradius

CFLAGS		+= -DLOGDIR=\"@logdir@\" -DRADDBDIR=\"@raddbdir@\" \
		   -DRUNDIR=\"@localstatedir@/run\" -DSBDIRDIR=\"@sbindir@\" \
		   -DRADIR=\"@radacctdir@\"

all:	radiusd radwho radzap raduse radclient $(BUILDDBM)

radiusd: $(SERVER_OBJS)
	$(CC) $(LDFLAGS) -o radiusd $(SERVER_OBJS) $(LIBS) $(LDBM) \
		$(LCRYPT) $(LIBDL)

radiusd.o: radiusd.c $(INCLUDES)
	$(CC) $(CFLAGS) -c radiusd.c

acct.o: acct.c $(INCLUDES)
	$(CC) $(CFLAGS) -c acct.c

files.o: files.c $(INCLUDES)
	$(CC) $(CFLAGS) -c files.c

files_b.o: files.c $(INCLUDES)
	$(CC) $(CFLAGS) -DBUILDDBM -o files_b.o -c files.c

util.o: util.c $(INCLUDES)
	$(CC) $(CFLAGS) -c util.c

nas.o:  nas.c $(INCLUDES)
	$(CC) $(CFLAGS) -c nas.c

modules.o:  modules.c $(INCLUDES) modules_static.h
	$(CC) $(CFLAGS) -c modules.c

radutmp.o:  radutmp.c $(INCLUDES)
	$(CC) $(CFLAGS) -c radutmp.c

proxy.o:  proxy.c $(INCLUDES)
	$(CC) $(CFLAGS) -c proxy.c

exec.o:  exec.c $(INCLUDES)
	$(CC) $(CFLAGS) -c exec.c

auth.o:  auth.c $(INCLUDES)
	$(CC) $(CFLAGS) -c auth.c

valuepair.o:  valuepair.c $(INCLUDES)
	$(CC) $(CFLAGS) -c valuepair.c

version.o: version.c $(INCLUDES)
	$(CC) $(CFLAGS) -o version.o -c version.c

radclient: radclient.o
	$(CC) $(LDFLAGS) -o radclient radclient.o $(LIBS)

radclient.o: radclient.c $(INCLUDES)
	$(CC) $(CFLAGS) -c radclient.c

builddbm: builddbm.o files_b.o log.o
	$(CC) $(LDFLAGS) -o builddbm builddbm.o files_b.o log.o $(LDBM) $(LIBS)

builddbm.o: builddbm.c
	$(CC) $(CFLAGS) -c builddbm.c

radwho: radwho.o util.o
	$(CC) $(LDFLAGS) -o radwho radwho.o util.o $(LIBS)

raduse: raduse.o
	$(CC) $(LDFLAGS) -o raduse raduse.o $(LIBS)

modules_static.h: modules_static.h.in
	rm -f modules_static.h
	cp modules_static.h.in modules_static.h
	./makelist.sh $(MODULES) >> modules_static.h

radzap: radzap.o util.o nas.o radutmp.o log.o
	$(CC) $(LDFLAGS) -o radzap radzap.o util.o nas.o radutmp.o log.o $(LIBS)

clean:
	rm -f *.o *.so modules_static.h radiusd radwho raduse \
		radclient radzap builddbm

install:
	install -m 755 -s radiusd		$(ROOT)$(sbindir)
	install -m 755    checkrad.pl		$(ROOT)$(sbindir)/checkrad
	install -m 755 -s radwho raduse		$(ROOT)$(bindir)
	install -m 755 -s radzap $(BUILDDBM)	$(ROOT)$(bindir)
	install -m 755    radlast		$(ROOT)$(bindir)
	install -m 755    radtest radclient	$(ROOT)$(bindir)

